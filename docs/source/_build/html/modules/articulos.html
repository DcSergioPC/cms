<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Artículos &#8212; cms 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=c058f7c8" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=8d563738"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cuentas" href="cuentas.html" />
    <link rel="prev" title="Documentación del Sistema de Administración de Contenido - CMS" href="../index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="articulos">
<h1>Artículos<a class="headerlink" href="#articulos" title="Link to this heading">¶</a></h1>
<section id="modelos">
<h2>Modelos<a class="headerlink" href="#modelos" title="Link to this heading">¶</a></h2>
<p><strong>Descripción de Clases de models.py</strong></p>
<ul class="simple">
<li><p>Categoria</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Categoria</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="n">titulo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">titulo</span>
</pre></div>
</div>
<p>importamos el modulo models para definir los modelos en nuestro proyecto CMS</p>
<p>Para representar la estructura de Categorias se utiliza una clase Categoria que posee un campo que almacena el nombre de dicha categoria. En este caso se utiliza CharField para definir una tamano maximo para el texto</p>
<ul class="simple">
<li><p>Plantilla</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Plantilla</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="n">titulo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">descripcion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
<span class="n">contenido</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

<span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">titulo</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">descripcion</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">contenido</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Para representar la estructura de Plantillas utilizamos una clase llamada Plantilla</p>
<p>El atributo titulo sera el nombre de la plantilla. Tendra un tamano maximo de 255 caracteres utilizando CharField</p>
<p>El atributo descripcion almacena la descripcion de la Plantilla. En este caso, mediante TextField</p>
<p>El atributo contenido almacena el contenido de la plantilla que se define en la seccion de plantillas del proyecto cms</p>
<ul class="simple">
<li><p>Article</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="n">STATUS_CHOICES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;pendiente&#39;</span><span class="p">,</span> <span class="s1">&#39;Pendiente&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;revision&#39;</span><span class="p">,</span> <span class="s1">&#39;Revision&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;aprobado&#39;</span><span class="p">,</span> <span class="s1">&#39;Aprobado&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;publicado&#39;</span><span class="p">,</span> <span class="s1">&#39;Publicado&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;rechazado&#39;</span><span class="p">,</span> <span class="s1">&#39;Rechazado&#39;</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

<span class="c1">##################</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">&#39;images/&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">video</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">&#39;videos/&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">####################</span>
<span class="n">categoria</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Categoria</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plantilla</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Plantilla</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Usuario que creó el artículo</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">STATUS_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;pendiente&#39;</span><span class="p">)</span>
<span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Modelo Article representa la estructura de un articulo en la base de datos</p>
<p>El atributo titulo sera el nombre del articulo. Tendra un tamano maximo de 255 caracteres utilizando CharField</p>
<p>El atributo content almacena el contenido del articulo que se define en la seccion de articulos del proyecto cms</p>
<p>El atributo image permite subir imagenes para los articulos utilizando ImageField (blank=True y null=True indica que es opcional)</p>
<p>El atributo video permite subir videos para los articulos utilizando FileField (blank=True y null=True indica que es opcional)</p>
<p>El atributo categoria es un campo de clave foranea que relaciona el articulo con una categoria Categoria existente. En el caso de que se elimina la categoria, el articulo no se eliminara debido a on_delete=models.SET_NULL, que pondra al campo categoria en NULL</p>
<p>El atributo plantilla es un campo de clave foranea que relaciona el articulo con una plantilla Plantilla existente. En el caso de que se elimina la Plantilla, el articulo no se eliminara debido a on_delete=models.SET_NULL, que pondra al campo Plantilla en NULL</p>
<ul class="simple">
<li><p>Comentario</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Comentario</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;comentarios&#39;</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>  <span class="c1"># Asegúrate de usar esto</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Comentario de </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s1"> en </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">article</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Se utiliza modelo de Comentario. Con este modelo se crea una base de datos para comentarios</p>
<p>Mediante el campo article se crea una relacion de clave foranea con modelo Article. Con esto, el objetivo es asociar cada comentario con articulos dependiendo de la clave</p>
<p>Mediante el campo user se crea una relacion de clave foranea con modelo Article. Con esto, se asocia cada el usuario con el modelo de usuario</p>
<p>En el campo content se guarda el contenido del comentario que realiza el usuario</p>
<p>Cuando el usuario realiza comentarios, éste almacena la fecha en el campo created_at (fecha y hora)</p>
<ul class="simple">
<li><p>Notification</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">###############################Notificaciones</span>
<span class="k">class</span> <span class="nc">Notification</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">is_read</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Se utiliza modelo de Notification para representar notificaciones del sistema CMS</p>
<p>En el campo user se establece una relacion que permita que un usuario pueda recibir una o mas notificaciones</p>
<p>El modelo de usuario que se utiliza esta representado por settings.AUTH_USER_MODEL (personalizado)</p>
<p>El campo message almacena texto que representa el mensaje de la notificacion</p>
<p>El campo is_read por defecto esta en false, indica si la notificacion se ha leido o no</p>
<p>El campo created_at refleja la hora y fecha con DateTimeField automaticamente</p>
<ul class="simple">
<li><p>Like</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Like</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="n">article</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;likes&#39;</span><span class="p">)</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>  <span class="c1"># Asegúrate de usar esto</span>
<span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">toggle_like</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="n">like</span> <span class="o">=</span> <span class="n">Like</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">article</span><span class="o">=</span><span class="n">article</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">like</span><span class="p">:</span>
        <span class="n">like</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">like</span> <span class="o">=</span> <span class="n">Like</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">article</span><span class="o">=</span><span class="n">article</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">like</span>

<span class="k">def</span> <span class="nf">filterArticleLikedByUser</span><span class="p">(</span><span class="n">articles</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="n">articles_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">article</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">article</span> <span class="ow">in</span> <span class="n">articles</span><span class="p">]</span>
    <span class="n">likes</span> <span class="o">=</span> <span class="n">Like</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">article_id__in</span><span class="o">=</span><span class="n">articles_ids</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
    <span class="n">liked_articles_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">like</span><span class="o">.</span><span class="n">article</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">like</span> <span class="ow">in</span> <span class="n">likes</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">article</span> <span class="ow">in</span> <span class="n">articles</span><span class="p">:</span>
        <span class="n">article</span><span class="o">.</span><span class="n">liked</span> <span class="o">=</span> <span class="n">article</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">liked_articles_ids</span>
    <span class="k">return</span> <span class="n">articles</span>

<span class="k">def</span> <span class="nf">ifArticleLikedByUser</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="n">like</span> <span class="o">=</span> <span class="n">Like</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">article</span><span class="o">=</span><span class="n">article</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">like</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Like de </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s1"> en </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">article</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Se utiliza modelo de Like para que el usuario con un rol determinado pueda dar “Me gusta” a la publicación</p>
<p>Se utiliza el campo article para asociar el modelo Like con Article para representar la relacion entre el articulo y el “Me gusta” del usuario y mediante on_delete=models.CASCADE se especifica que se borraran los registros de me gusta si se elimina la publicacion</p>
<p>Se utiliza el campo user para especificar el usuario. En este caso el usuario es personalizado (en models - CustomUser) por lo que se utiliza settings.AUTH_USER_MODEL</p>
<p>Se utiliza el campo created_At para definir la fecha.</p>
<p>El método toggle_like permite hacer y deshacer el “Me gusta”</p>
<p>El método filterArticleLikedByUser muestra los articulos que han sido del agrado del usuario. Es decir, aquellos que recibieron “Me gusta”</p>
<p>El método ifArticleLikedByUser establece si el usuario ha dado o no “Me gusta” a la publicacion por medio de valores booleanos True o False (atributo)</p>
<ul class="simple">
<li><p>View</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">View</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="n">article</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;views&#39;</span><span class="p">)</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>  <span class="c1"># Asegúrate de usar esto</span>
<span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_View_If_Not_Exists</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">View</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">article</span><span class="o">=</span><span class="n">article</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">view</span><span class="p">:</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">View</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">article</span><span class="o">=</span><span class="n">article</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">view</span>

<span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Vista de </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s1"> en </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">article</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Se utiliza modelo de View que permite registrar las vistas de las publicaciones</p>
<p>Se utiliza el campo article para asociar el modelo View con Article para representar la relacion entre el articulo y la vista del usuario y mediante on_delete=models.CASCADE se especifica que se borraran los registros de vistas (todos los asociados a un articulo) si se elimina la publicacion</p>
<p>Se utiliza el campo user para especificar el usuario. En este caso el usuario es personalizado (en models - CustomUser) por lo que se utiliza settings.AUTH_USER_MODEL</p>
<p>Se utiliza el campo created_At para definir la fecha.</p>
<p>El método create_View_If_Not_Exists permite registrar la visualizacion del usuario solo una vez (no cuenta una vista por cada vez que el usuario accede)</p>
<p>Solo en el caso de que el usuario no haya visto el articulo, se crea la vista con view = View.objects.create(article=article, user=user)</p>
<ul class="simple">
<li><p>ArticleVersion</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticleVersion</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

<span class="n">change_description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

<span class="n">article</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;histories&#39;</span><span class="p">)</span>
<span class="n">change_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">changed_by</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;article_changes&#39;</span><span class="p">)</span>

<span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
<span class="c1">##################</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">&#39;images/&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">video</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">&#39;videos/&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">####################</span>
<span class="n">categoria</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;Sin Categoría&#39;</span><span class="p">)</span>  <span class="c1"># Agrega un valor por defecto</span>
<span class="n">plantilla</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;Sin Plantilla&#39;</span><span class="p">)</span>
<span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Usuario que creó el artículo</span>

<span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>En el campo change_description se detalla a través de una descripción que cambios se realizan en articulo</p>
<p>En el campo article = models.ForeignKey(Article, on_delete=models.CASCADE, related_name=’histories’) se relaciona al modelo Article para establecer a qué artículo hacemos referencia. Con (on_delete = models.CASCADE) desaparecen las versiones en caso de eliminacióno</p>
<p>En el campo change_date se guarda la fecha y hora de creación de versión</p>
<p>En el campo changed_by se guarda quién realizó los cambios para esa versión</p>
<p>El campo title almacena el título del articulo</p>
<p>El campo content almacena el contenido del articulo</p>
<p>El campo image almacena la imagen del articulo</p>
<p>El campo video almacena el video del articulo</p>
<p>El campo categoria almacena la categoría del articulo</p>
<p>El campo plantilla almacena la plantilla del articulo</p>
<p>El campo author almacena el autor del articulo</p>
<section id="documentacion-generada-por-sphinx-8-0-2">
<h3>Documentacion generada por Sphinx 8.0.2<a class="headerlink" href="#documentacion-generada-por-sphinx-8-0-2" title="Link to this heading">¶</a></h3>
</section>
</section>
<section id="vistas">
<h2>Vistas<a class="headerlink" href="#vistas" title="Link to this heading">¶</a></h2>
<p><strong>Descripción de Clases de views.py</strong></p>
<ul class="simple">
<li><p>index</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
    <span class="n">articles</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>  <span class="c1"># Solo artículos del usuario autenticado</span>

    <span class="c1"># Aplicar el filtro</span>
    <span class="n">article_filter</span> <span class="o">=</span> <span class="n">ArticleFilter</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>

    <span class="c1"># Obtener los artículos filtrados</span>
    <span class="n">articles</span> <span class="o">=</span> <span class="n">article_filter</span><span class="o">.</span><span class="n">qs</span>


    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/index.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="n">article_filter</span><span class="p">,</span> <span class="s1">&#39;articles&#39;</span><span class="p">:</span> <span class="n">articles</span><span class="p">})</span>
    <span class="c1">#return render(request, &#39;articulos/index.html&#39;, {&#39;articles&#39;: articles})</span>
<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Se obtiene todos los registros de tabla Article que esta almacenada en la base de datos</p>
<p>Se guardan los articulos en diccionario params, donde la clave es ‘articles’ y el valor es el definido arriba (articles)</p>
<p>Se visualiza la lista de articulos mediante render(request, ‘articulos/index.html’, params) que renderiza la plantilla pasandole los datos del diccionario</p>
<ul class="simple">
<li><p>create</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
 <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">)</span>
     <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
         <span class="c1">#form.save()</span>
         <span class="n">article</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
         <span class="n">article</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>  <span class="c1"># Asigna el autor</span>
         <span class="n">article</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;pendiente&#39;</span>  <span class="c1"># Establece el estado a &quot;pending&quot;</span>
         <span class="n">article</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
         <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:index&#39;</span><span class="p">)</span>
 <span class="k">else</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">()</span>

 <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/create.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</pre></div>
</div>
<p>Se usa la condicional if request.method == ‘POST’ que define que el usuario envia un formulario</p>
<p>Con ArticleForm(request.POST, request.FILES) se crea un objeto formulario con los datos ingresdos por el usuario</p>
<p>Con form.is_valid() se validan los datos del formulario y se guardan con form.save()</p>
<ul class="simple">
<li><p>detail</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">article_id</span><span class="p">):</span>
 <span class="n">article</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span>
 <span class="n">comentarios</span> <span class="o">=</span> <span class="n">article</span><span class="o">.</span><span class="n">comentarios</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

 <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">ComentarioForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
     <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
         <span class="n">comentario</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
         <span class="n">comentario</span><span class="o">.</span><span class="n">article</span> <span class="o">=</span> <span class="n">article</span>
         <span class="n">comentario</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
         <span class="n">comentario</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
         <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:detail&#39;</span><span class="p">,</span> <span class="n">article_id</span><span class="o">=</span><span class="n">article</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
 <span class="k">else</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">ComentarioForm</span><span class="p">()</span>

 <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s1">&#39;article&#39;</span><span class="p">:</span> <span class="n">article</span><span class="p">,</span>
     <span class="s1">&#39;comentarios&#39;</span><span class="p">:</span> <span class="n">comentarios</span><span class="p">,</span>
     <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
 <span class="p">}</span>
 <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/detail.html&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>detail muestra los detalles de un articulo</p>
<p>Se obtiene el articulo con el ID correspondiente mediante Article.objects.get(id=article_id)</p>
<p>Se guardan los articulos en diccionario params, donde la clave es ‘articles’ y el valor es el definido arriba (articles)</p>
<p>Se visualizan articulos mediante render(request, ‘articulos/index.html’, params) que renderiza la plantilla detail.html pasandole los datos del diccionario</p>
<ul class="simple">
<li><p>edit</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">article_id</span><span class="p">):</span>
 <span class="n">article</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span>

 <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">article</span><span class="p">)</span>  <span class="c1"># Usa request.FILES para archivos</span>
     <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
         <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
         <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:detail&#39;</span><span class="p">,</span> <span class="n">article_id</span><span class="p">)</span>
 <span class="k">else</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">article</span><span class="p">)</span>  <span class="c1"># Usa la instancia para prellenar el formulario</span>

 <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/edit.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;article&#39;</span><span class="p">:</span> <span class="n">article</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</pre></div>
</div>
<p>Se obtiene el articulo con el ID correspondiente mediante get_object_or_404(Article, id=article_id). Si no existe, error 404</p>
<p>Se usa la condicional if request.method == ‘POST’ que define que el usuario envia un formulario</p>
<p>Con ArticleForm(request.POST, request.FILES, instance=article) se cargan objeto formulario con los datos ingresados por el usuario en el articulo</p>
<p>Con form.is_valid() se validan los datos del formulario y se guardan con form.save()</p>
<ul class="simple">
<li><p>delete</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">article_id</span><span class="p">):</span>
 <span class="n">article</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span>
 <span class="k">if</span> <span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">):</span>
     <span class="n">article</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
     <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:index&#39;</span><span class="p">)</span>
 <span class="k">else</span><span class="p">:</span>
     <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s1">&#39;article&#39;</span><span class="p">:</span> <span class="n">article</span><span class="p">,</span>
     <span class="p">}</span>
     <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/delete.html&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>Mediante Article.objects.get(id=article_id) obtenemos el articulo a eliminar</p>
<p>Se usa la condicional if request.method == ‘POST’ que define que el usuario quiere eliminar el articulo</p>
<p>El articulo se elimina de la base de datos con article.delete()</p>
<p>En el caso de que sea un metodo GET, el sistema muestra una pantalla para confirmar eliminacion</p>
<ul class="simple">
<li><p>plantilla_index</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plantilla_index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
 <span class="n">plantillas</span> <span class="o">=</span> <span class="n">Plantilla</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
 <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s1">&#39;plantillas&#39;</span><span class="p">:</span> <span class="n">plantillas</span><span class="p">,</span>
 <span class="p">}</span>
 <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/plantilla_index.html&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>Se obtiene todas las plantillas almacenadas en la base de datos mediante Plantilla.objects.all()</p>
<p>Mediante el uso de diccionario params, las plantillas se guardan con clave “plantillas” y valor “plantillas”</p>
<p>Utilizando render(request, ‘articulos/plantilla_index.html’, params) se renderiza la plantilla plantilla_index.html, en donde se muestran en la pagina de lista de plantillas las plantillas almacenadas</p>
<ul class="simple">
<li><p>plantilla_create</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plantilla_create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
 <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">PlantillaForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>  <span class="c1"># Asegúrate de incluir request.FILES</span>
     <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
         <span class="c1"># Crear una nueva instancia de Plantilla con los datos del formulario</span>
         <span class="n">plantillas</span> <span class="o">=</span> <span class="n">Plantilla</span><span class="p">(</span>
             <span class="n">titulo</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;titulo&#39;</span><span class="p">],</span>
             <span class="n">descripcion</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;descripcion&#39;</span><span class="p">],</span>
             <span class="n">contenido</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;contenido&#39;</span><span class="p">]</span>
         <span class="p">)</span>
         <span class="n">plantillas</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
         <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:plantilla_index&#39;</span><span class="p">)</span>
 <span class="k">else</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">PlantillaForm</span><span class="p">()</span>

 <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/plantilla_create.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</pre></div>
</div>
<p>Se usa la condicional if request.method == ‘POST’ que define que el usuario envia un formulario</p>
<p>Con PlantillaForm(request.POST) se crea un formulario con datos de plantilla del usuario</p>
<p>Con form.is_valid() se validan los datos del formulario y se guardan con form.save()</p>
<p>Se renderiza la plantilla plantilla_create.html pasando el formulario con render(request, ‘articulos/plantilla_create.html’, {‘form’: form}).</p>
<ul class="simple">
<li><p>plantilla_detail</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plantilla_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">plantillas_id</span><span class="p">):</span>
 <span class="n">plantillas</span> <span class="o">=</span> <span class="n">Plantilla</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">plantillas_id</span><span class="p">)</span>
 <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s1">&#39;plantillas&#39;</span><span class="p">:</span> <span class="n">plantillas</span><span class="p">,</span>
 <span class="p">}</span>
 <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/plantilla_detail.html&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>Se obtiene la plantilla con el ID que se especifica en Plantilla.objects.get(id=plantillas_id) mediante una consulta a la base de Datos</p>
<p>Mediante el uso de diccionario params, las plantillas se guardan con clave “plantillas” y valor “plantillas”</p>
<p>Se renderiza la plantilla plantilla_detail.html pasando el formulario con render(request, ‘articulos/plantilla_create.html’, {‘form’: form}).</p>
<ul class="simple">
<li><p>plantilla_edit</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plantilla_edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">plantillas_id</span><span class="p">):</span>
 <span class="n">plantilla</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Plantilla</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">plantillas_id</span><span class="p">)</span>

 <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">PlantillaForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">plantilla</span><span class="p">)</span>
     <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
         <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
         <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:plantilla_detail&#39;</span><span class="p">,</span> <span class="n">plantillas_id</span><span class="p">)</span>
 <span class="k">else</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">PlantillaForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">plantilla</span><span class="p">)</span>  <span class="c1"># Usa la instancia para prellenar el formulario</span>

 <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/plantilla_edit.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;plantilla&#39;</span><span class="p">:</span> <span class="n">plantilla</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</pre></div>
</div>
<p>Se obtiene la plantilla con el ID correspondiente mediante get_object_or_404(Plantilla, id=plantillas_id). Si no existe, error 404</p>
<p>Se usa la condicional if request.method == ‘POST’ que define que el usuario envia un formulario</p>
<p>Con PlantillaForm(request.POST, instance=plantilla) se cargan objeto formulario con los datos ingresados por el usuario en la plantilla</p>
<p>Con form.is_valid() se validan los datos del formulario y se guardan con form.save()</p>
<ul class="simple">
<li><p>plantilla_delete</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plantilla_delete</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">plantillas_id</span><span class="p">):</span>
 <span class="n">plantilla</span> <span class="o">=</span> <span class="n">Plantilla</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">plantillas_id</span><span class="p">)</span>
 <span class="k">if</span> <span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">):</span>
     <span class="n">plantilla</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
     <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:plantilla_index&#39;</span><span class="p">)</span>
 <span class="k">else</span><span class="p">:</span>
     <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s1">&#39;plantilla&#39;</span><span class="p">:</span> <span class="n">plantilla</span><span class="p">,</span>
     <span class="p">}</span>
     <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/plantilla_delete.html&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>Se obtiene la plantilla con el ID que se especifica en Plantilla.objects.get(id=plantillas_id) mediante una consulta a la base de Datos</p>
<p>Se usa la condicional if request.method == ‘POST’ que define que el usuario quiere eliminar la plantilla</p>
<p>La plantilla se elimina de la base de datos con plantilla.delete()</p>
<p>En el caso de que sea un metodo GET, el sistema muestra una pantalla para confirmar eliminacion</p>
<ul class="simple">
<li><p>categoria_list</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">categoria_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
 <span class="n">categorias</span> <span class="o">=</span> <span class="n">Categoria</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
 <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/categoria_list.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;categorias&#39;</span><span class="p">:</span> <span class="n">categorias</span><span class="p">})</span>
</pre></div>
</div>
<p>Se obtiene las categorias con Categoria.objects.all() mediante una consulta a la base de Datos</p>
<p>Se renderiza la plantilla categoria_list.html, en donde render(request, ‘articulos/categoria_list.html’, {‘categorias’: categorias}) pasa las categorias para visualizar en la pagina de categorias</p>
<ul class="simple">
<li><p>categoria_create</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">categoria_create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
 <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">CategoriaForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
     <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
         <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
         <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:categoria_list&#39;</span><span class="p">)</span>
 <span class="k">else</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">CategoriaForm</span><span class="p">()</span>
 <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/categoria_form.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</pre></div>
</div>
<p>Su funcion es crear una nueva categoria</p>
<p>Se usa la condicional if request.method == ‘POST’ que define que el usuario envia un formulario</p>
<p>Con form.is_valid() se validan los datos del formulario y se guardan con form.save()</p>
<ul class="simple">
<li><p>categoria_update</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">categoria_update</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
 <span class="n">categoria</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Categoria</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
 <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">CategoriaForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">categoria</span><span class="p">)</span>
     <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
         <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
         <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:categoria_list&#39;</span><span class="p">)</span>
 <span class="k">else</span><span class="p">:</span>
     <span class="n">form</span> <span class="o">=</span> <span class="n">CategoriaForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">categoria</span><span class="p">)</span>
 <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/categoria_form.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</pre></div>
</div>
<p>Se obtiene la categoria con el ID que se especifica en get_object_or_404(Categoria, pk=pk) mediante una consulta a la base de Datos</p>
<p>Se usa la condicional if request.method == ‘POST’ que define que el usuario envia un formulario</p>
<p>Con form.is_valid() se validan los datos del formulario y se guardan con form.save()</p>
<ul class="simple">
<li><p>categoria_delete</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">categoria_delete</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
 <span class="n">categoria</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Categoria</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
 <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
     <span class="n">categoria</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
     <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:categoria_list&#39;</span><span class="p">)</span>
 <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/categoria_confirm_delete.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;categoria&#39;</span><span class="p">:</span> <span class="n">categoria</span><span class="p">})</span>
</pre></div>
</div>
<p>Se obtiene la categoria con el ID que se especifica en get_object_or_404(Categoria, pk=pk) mediante una consulta a la base de Datos</p>
<p>Se usa la condicional if request.method == ‘POST’ que define que el usuario quiere eliminar la categoria</p>
<p>La categoria se elimina de la base de datos con categoria.delete()</p>
<ul class="simple">
<li><p>article_list</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">article_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">articles</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="nb">filter</span> <span class="o">=</span> <span class="n">ArticleFilter</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">articles</span><span class="p">)</span>  <span class="c1"># Aplicamos el filtro</span>

<span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/index.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="nb">filter</span><span class="p">})</span>
</pre></div>
</div>
<p>Se obtiene todos los objetos del modelo Article que estan almancenados en la base de datos con Article.objects.all()</p>
<p>Con Django Filter se utliza un filtro para filtrar articulos dependiendo de los requerimientos, como categorias, plantillas, etc. Los parametros de la solicitud GET son pasados al filtro</p>
<ul class="simple">
<li><p>aceptar_articulo</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">aceptar_articulo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">article_id</span><span class="p">):</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span>
    <span class="n">article</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;aprobado&#39;</span>
    <span class="n">article</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:manejar_articulos&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Se obtiene el articulo con el ID correspondiente mediante get_object_or_404(Article, id=article_id). Si no existe, error 404</p>
<p>Se asigna el estado “aprobado” al articulo con article.status = ‘aprobado’, luego se guarda con article.save()</p>
<ul class="simple">
<li><p>reject_article</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reject_article</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">article_id</span><span class="p">):</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span>
    <span class="n">article</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;rechazado&#39;</span>
    <span class="n">article</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:manejar_articulos&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Se obtiene el articulo con el ID correspondiente mediante get_object_or_404(Article, id=article_id). Si no existe, error 404</p>
<p>Se asigna el estado “rechazado” al articulo con article.status = ‘rechazado’, luego se guarda con article.save()</p>
<ul class="simple">
<li><p>publicar_articulo</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">publicar_articulo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">article_id</span><span class="p">):</span>
<span class="n">article</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span>
<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
    <span class="n">article</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;publicado&#39;</span>
    <span class="n">article</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:manejar_articulos&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Se obtiene el articulo con el ID correspondiente mediante get_object_or_404(Article, id=article_id). Si no existe, error 404</p>
<p>Si el rol de usuario es “admin” se asigna el estado “publicado” al articulo con article.status = ‘publicado’, luego se guarda con article.save()</p>
<ul class="simple">
<li><p>articulos_publicados</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">articulos_publicados</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">articles</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;publicado&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/articulos_publicados.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;articles&#39;</span><span class="p">:</span> <span class="n">articles</span><span class="p">})</span>
</pre></div>
</div>
<p>Se filtran los articulos con estado “publicado” almacenadas en la base de datos con Article.objects.filter(status=’publicado’)</p>
<ul class="simple">
<li><p>manejar_articulos</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">manejar_articulos</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1">#comprobamos si el usuario es el administrador</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="n">articles</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">status__in</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pendiente&#39;</span><span class="p">,</span> <span class="s1">&#39;revision&#39;</span><span class="p">,</span> <span class="s1">&#39;aprobado&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/manejar_articulos.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;articles&#39;</span><span class="p">:</span> <span class="n">articles</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:index&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Los usuarios autenticados podran manejar los articulos mediante request.user.is_authenticated</p>
<p>Se obtienen todos los articulos almacenados en la base de datos (con estados pendiente, revision, aprobado)</p>
<ul class="simple">
<li><p>ver_articulo</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ver_articulo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">article_id</span><span class="p">):</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">article</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pendiente&#39;</span><span class="p">,</span> <span class="s1">&#39;revision&#39;</span><span class="p">]:</span>
        <span class="n">article</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;revision&#39;</span>
        <span class="n">article</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;aceptar&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
            <span class="n">article</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;aprobado&#39;</span>
            <span class="n">article</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">elif</span> <span class="s1">&#39;rechazar&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
            <span class="n">article</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;rechazado&#39;</span>
            <span class="n">article</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">elif</span> <span class="s1">&#39;publicar&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
            <span class="n">article</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;publicado&#39;</span>
            <span class="n">article</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/ver_articulo.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;article&#39;</span><span class="p">:</span> <span class="n">article</span><span class="p">,</span> <span class="s1">&#39;myRole&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="p">})</span>
</pre></div>
</div>
<p>Se obtiene el articulo con el ID correspondiente mediante get_object_or_404(Article, id=article_id). Si no existe, error 404</p>
<p>Cuando el usuario ingrese a la vista de ver_articulo, el articulo cambia de estado a “revision” si esta en “pendiente” o “revision” (article.status = ‘revision’)</p>
<p>Si se recibe peticion en form de boton Aceptar el estado se establece en “aprobado” (article.status = ‘aprobado’)</p>
<p>Si se recibe peticion en form de boton Rechazar el estado se establece en “rechazado” (article.status = ‘rechazado’)</p>
<p>Si se recibe peticion en form de boton Publicar el estado se establece en “publicado” (article.status = ‘publicado’)</p>
<ul class="simple">
<li><p>tablero_kanban</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tablero_kanban</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
    <span class="n">articles</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/kanban.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;articles&#39;</span><span class="p">:</span> <span class="n">articles</span><span class="p">})</span>
<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Los usuarios autenticados tendran acceso a la vista de tablero kanban (request.user.is_authenticated)</p>
<p>Se obtiene todos los articulos y se observan sus estados correspondientes (Article.objects.all())</p>
<ul class="simple">
<li><p>edit_comentario</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">edit_comentario</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">comentario_id</span><span class="p">):</span>
    <span class="n">comentario</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Comentario</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">comentario_id</span><span class="p">)</span>

    <span class="c1"># Verifica que el usuario sea el autor del comentario</span>
    <span class="k">if</span> <span class="n">comentario</span><span class="o">.</span><span class="n">user</span> <span class="o">!=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:detail&#39;</span><span class="p">,</span> <span class="n">article_id</span><span class="o">=</span><span class="n">comentario</span><span class="o">.</span><span class="n">article</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ComentarioForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">comentario</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:detail&#39;</span><span class="p">,</span> <span class="n">article_id</span><span class="o">=</span><span class="n">comentario</span><span class="o">.</span><span class="n">article</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ComentarioForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">comentario</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/edit_comentario.html&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;article&#39;</span><span class="p">:</span> <span class="n">comentario</span><span class="o">.</span><span class="n">article</span><span class="p">,</span>
    <span class="p">})</span>
</pre></div>
</div>
<p>Se obtiene comentario con el ID correspondiente mediante get_object_or_404(Comentario, id=comentario_id). Si no existe, error 404</p>
<p>Se comprueba que el usuario que quiere editar comentario es el mismo que realizo (comentario.user != request.user:), si no, va a pantalla detail</p>
<p>En la segunda condicion (request.method == ‘POST’) se compreuba que la solicitud es un envio de formulario</p>
<p>Se crea una instancia de ComentarioForm con los datos y establece el comentario que ya existia como instancia a editar (ComentarioForm(request.POST, instance=comentario))</p>
<ul class="simple">
<li><p>delete_comentario</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_comentario</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">comentario_id</span><span class="p">):</span>
<span class="n">comentario</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Comentario</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">comentario_id</span><span class="p">)</span>

<span class="c1"># Verifica que el usuario sea el autor del comentario</span>
<span class="k">if</span> <span class="n">comentario</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
    <span class="n">comentario</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;articulos:detail&#39;</span><span class="p">,</span> <span class="n">article_id</span><span class="o">=</span><span class="n">comentario</span><span class="o">.</span><span class="n">article</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
<p>Se obtiene comentario con el ID correspondiente mediante get_object_or_404(Comentario, id=comentario_id). Si no existe, error 404</p>
<p>Se comprueba que el usuario que quiere eliminar el comentario es el mismo que realizo (comentario.user == request.user)</p>
<p>Se elimina el comentario (comentario.delete())</p>
<ul class="simple">
<li><p>create_notification</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_notification</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>Funcion create_notification() que crea una notificación que se visualizar en el sistema</p>
<p>Tiene dos parametros: user y message</p>
<p>El parametro user representa un objeto de tipo usuario. Es util para identificar al receptor de la notificacion</p>
<p>El parametro message representa el mensaje que recibe el usuario a través de una notificacióno</p>
<ul class="simple">
<li><p>notifications_view</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">notifications_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">notifications</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>
    <span class="n">notifications</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_read</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">is_read</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">notifications</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>  <span class="c1">#muestra hasta 20 notificaciones</span>
    <span class="c1">#se obtiene numero de pagina de notificaciones</span>
    <span class="n">page_number</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">)</span>
    <span class="n">notifications_page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page_number</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/notificaciones.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;notifications&#39;</span><span class="p">:</span> <span class="n">notifications_page</span><span class="p">})</span>
</pre></div>
</div>
<p>Funcion notifications_view() que crea visualizacion de notificaciones en el sistema</p>
<p>La funcion posee el parametro request. Representa la solicitud http que realiza el user</p>
<p>Se filtran las notificaciones con Notification.objects.filter(user=request.user).order_by(‘-created_at’)</p>
<p>Con Paginator se muestran hasta 20 notificaciones por pagina. Si hay mas, pasan a otra pagina - paginator = Paginator(notifications, 20)</p>
<p>A través de page_number = request.GET.get(‘page’) se pueden visualizar las diferentes paginas de notificaciones</p>
<p>Se renderiza notificaciones.html, es decir se utiliza la plantilla para mostrar las notificaciones recibidas con return render(request, ‘articulos/notificaciones.html’, {‘notifications’: notifications_page})</p>
<ul class="simple">
<li><p>reportes</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># vistas de reportes</span>
<span class="k">def</span> <span class="nf">reportes</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="n">articles</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">unread_notifications_count</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">notification_set</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_read</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="c1"># Obtener la cantidad de artículos publicados por cada usuario con el estado &quot;publicado&quot;</span>
        <span class="n">articles_by_user</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;publicado&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;author__username&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span>
        <span class="c1"># Obtener la cantidad de artículos publicados por mes</span>
        <span class="n">articles_by_month</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;publicado&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="n">TruncMonth</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/reportes.html&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;articles&#39;</span><span class="p">:</span> <span class="n">articles</span><span class="p">,</span>
            <span class="s1">&#39;unread_notifications_count&#39;</span><span class="p">:</span> <span class="n">unread_notifications_count</span><span class="p">,</span>
            <span class="s1">&#39;articles_by_user&#39;</span><span class="p">:</span> <span class="n">articles_by_user</span><span class="p">,</span>  <span class="c1"># Pasar los datos al contexto</span>
            <span class="s1">&#39;articles_by_month&#39;</span><span class="p">:</span> <span class="n">articles_by_month</span><span class="p">,</span>  <span class="c1"># Pasar los datos al contexto</span>
        <span class="p">})</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Método reportes() que crea visualizacion de reportes según requerimientos en el sistema</p>
<p>A través de articles = Article.objects.all(), se recuperan los articulos</p>
<p>A través de la variable articles_by_user = Article.objects.filter(status=’publicado’).values(‘author__username’).annotate(count=Count(‘id’)) se obtiene la cantidad de publicaciones por cada usuario</p>
<p>A través de la variable articles_by_month = Article.objects.filter(status=’publicado’).annotate(month=TruncMonth(‘created_at’)).values(‘month’).annotate(count=Count(‘id’)).order_by(‘month’) se obtiene la cantidad de publicaciones realizadas por mes</p>
<p>Con return render(…) se renderiza la plantilla y se pasan los datos obtenidos en el metodo en reportes.html</p>
<ul class="simple">
<li><p>toggle_like</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">toggle_like</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">article_id</span><span class="p">):</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span>
    <span class="n">Like</span><span class="o">.</span><span class="n">toggle_like</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_REFERER&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>article = get_object_or_404(Article, id=article_id): se recuperan los articulos (si existen)</p>
<p>Like.toggle_like(article, request.user): permite hacer y deshacer el “Me gusta” del usuario</p>
<p>La pantalla sigue siendo la misma al dar clic a “Me gusta” y esto se logra medainte return HttpResponseRedirect(request.META.get(‘HTTP_REFERER’))</p>
<ul class="simple">
<li><p>cambios_articulo</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cambios_articulo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">article_id</span><span class="p">):</span>
<span class="c1"># Obtener el artículo específico</span>
<span class="n">article</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span>

<span class="c1"># Obtener todas las versiones del artículo</span>
<span class="n">versions</span> <span class="o">=</span> <span class="n">ArticleVersion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">article</span><span class="o">=</span><span class="n">article</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-change_date&#39;</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;article&#39;</span><span class="p">:</span> <span class="n">article</span><span class="p">,</span>
    <span class="s1">&#39;versions&#39;</span><span class="p">:</span> <span class="n">versions</span>
<span class="p">}</span>
<span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/cambios_articulo.html&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>A través de article = get_object_or_404(Article, id=article_id) se obtiene un articulo con id coincidente a article_id. En el caso de que no existe dicho articulo se genera 404 Not Found</p>
<p>En un articulo se recuperan (filtran) las versiones de un articulo seleccionado (filter) y se muestran en forma cronologica (order_by(‘-change_date’)) en versions = ArticleVersion.objects.filter(article=article).order_by(‘-change_date’)</p>
<p>Se establece params = {‘article’:article, ‘versions’:versions} para dar formato a plantilla para mostrar articulo con los cambios y las respectivas versiones que se recuperan en versions</p>
<p>Se establece la comunicacion HTTPS para la plantilla cambios_articulo.html con render y éste recibe el formato params para mostrar la informacion.</p>
<p>Básicamente, sirve para mostrar el historial de versiones de un determinado articulo</p>
<ul class="simple">
<li><p>version_detail</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">version_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">article_id</span><span class="p">,</span> <span class="n">version_id</span><span class="p">):</span>
<span class="c1"># Obtener el artículo específico</span>
<span class="n">article</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span>

<span class="c1"># Obtener la versión específica del artículo</span>
<span class="n">version</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">ArticleVersion</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">version_id</span><span class="p">,</span> <span class="n">article</span><span class="o">=</span><span class="n">article</span><span class="p">)</span>

<span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;articulos/version_detail.html&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;article&#39;</span><span class="p">:</span> <span class="n">article</span><span class="p">,</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">version</span>
<span class="p">})</span>
</pre></div>
</div>
<p>Como parámetros, tenemos el id del artículo y la versión para pasar a la plantilla que muestra la informacióno</p>
<p>A través de article = get_object_or_404(Article, id=article_id) se obtiene un articulo con id coincidente a article_id. En el caso de que no existe dicho articulo se genera 404 Not Found</p>
<p>A través de version = get_object_or_404(ArticleVersion, id=version_id, article=article) se determina la version del articulo que se filtra a través del id de la version que se recibió como dato, además del id del artículo (PRIMERO SE OBTIENE ID DE ARTICULO Y LUEGO ID DE VERSION DE ARTICULO PARA ASOCIAR)</p>
<p>Se muestra plantilla version_detail.html cuando se pasa formato de plantilla mediante ‘article’ y ‘version’ luego de generarse una respuesta HTTPS mediante la función render</p>
<p>Básicamente, sirve para mostrar cada campo de una determinada versión de un artículo</p>
</section>
<section id="formularios">
<h2>Formularios<a class="headerlink" href="#formularios" title="Link to this heading">¶</a></h2>
<p><strong>Descripción de Clases de forms.py</strong></p>
<ul class="simple">
<li><p>ArticleForm</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticleForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
 <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
     <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
     <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;video&#39;</span><span class="p">,</span><span class="s1">&#39;categoria&#39;</span><span class="p">,</span> <span class="s1">&#39;plantilla&#39;</span><span class="p">]</span>
     <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;cols&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">}),</span>
     <span class="p">}</span>

 <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
     <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;categoria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Categoria</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;categoria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">True</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;plantilla&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Plantilla</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;plantilla&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">True</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;plantilla&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">label_from_instance</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">titulo</span>  <span class="c1"># Mostrar solo el título</span>
</pre></div>
</div>
<p>Se utiliza ModelForm para heredar formularios basados en modelos de Django</p>
<p>Se define un formulario basado en el modelo Article</p>
<p>La clase Meta, proporciona metainformacion sobre el formulario</p>
<p>Este formulario se asocia al modelo Article</p>
<p>En el formulario se muestran los campos definidos en Article mediante fields = [‘title’, ‘content’, ‘image’, ‘video’,’categoria’, ‘plantilla’]</p>
<ul class="simple">
<li><p>PlantillaForm</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PlantillaForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
 <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
     <span class="n">model</span> <span class="o">=</span> <span class="n">Plantilla</span>
     <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;titulo&#39;</span><span class="p">,</span> <span class="s1">&#39;descripcion&#39;</span><span class="p">,</span> <span class="s1">&#39;contenido&#39;</span><span class="p">]</span>
     <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s1">&#39;descripcion&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;cols&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">}),</span>
     <span class="p">}</span>
</pre></div>
</div>
<p>Se utiliza ModelForm para heredar formularios basados en modelos de Django</p>
<p>Se define un formulario basado en el modelo Plantilla</p>
<p>La clase Meta, proporciona metainformacion sobre el formulario</p>
<p>Este formulario se asocia al modelo Plantilla</p>
<p>En el formulario se muestran los campos definidos en Plantilla mediante fields = [‘titulo’, ‘descripcion’, ‘contenido’]</p>
<ul class="simple">
<li><p>CategoriaForm</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CategoriaForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
 <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
     <span class="n">model</span> <span class="o">=</span> <span class="n">Categoria</span>
     <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;titulo&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Se utiliza ModelForm para heredar formularios basados en modelos de Django</p>
<p>Se define un formulario basado en el modelo Categoria</p>
<p>La clase Meta, proporciona metainformacion sobre el formulario</p>
<p>Este formulario se asocia al modelo Categoria</p>
<p>En el formulario se muestran los campos definidos en Categoria mediante fields = fields = [‘titulo’]</p>
<ul class="simple">
<li><p>ComentarioForm</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ComentarioForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Comentario</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span>
    <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;cols&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">}),</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Se utiliza ModelForm para heredar formularios basados en modelos de Django</p>
<p>Se define un formulario basado en el modelo Comentario</p>
<p>La clase Meta, proporciona metainformacion sobre el formulario</p>
<p>En el formulario se muestran los campos definidos en Comentario mediante fields = fields = [‘content’]</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">cms</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Artículos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#modelos">Modelos</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vistas">Vistas</a></li>
<li class="toctree-l2"><a class="reference internal" href="#formularios">Formularios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cuentas.html">Cuentas</a></li>
<li class="toctree-l1"><a class="reference internal" href="cms.html">CMS</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../index.html" title="previous chapter">Documentación del Sistema de Administración de Contenido - CMS</a></li>
      <li>Next: <a href="cuentas.html" title="next chapter">Cuentas</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Equipo 08.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.0.2</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/modules/articulos.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>